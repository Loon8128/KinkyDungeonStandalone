<!DOCTYPE html>
<html style="width:100%; height:100%; padding:0px; margin:0px;">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta charset="UTF-8">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<title>Kinky Dungeon Standalone</title>
	<link rel="icon" type="image/png" href="icon.png" id="favicon">

</head>

<body style="width:100%; height:100%; background-color:black; margin:0px; padding:0px; overflow:hidden;">

    <script>
        // Strategy:
        // 1. If commit= is specified, use that commit (using user/repo if specified)
        // 2. If v=latest, or any of user/repo/branch are specified, query github API for the latest commit from said branch
        // 3. Use the default commmit (stable) specified here
        const USER = 'Ada18980';
        const REPO = 'Bondage-College';
        const BRANCH = 'master';
        const COMMIT = '8927ed431dac491f8d0a72c151b3a75acd0fd352'; // Stable

        const STYLES = ['CSS/Styles.css'];
        const SOURCES = ['Scripts/lib/webgl/resources/m4.js', 'Scripts/lib/LZString.js', 'Scripts/lib/socket.io/socket.io.min.js', 'Scripts/lib/jquery-3.2.1.min.js', 'Backgrounds/Backgrounds.js', 'Scripts/GLDraw.js', 'Scripts/Common.js', 'Scripts/CommonDraw.js', 'Scripts/Animation.js', 'Scripts/Mouse.js', 'Scripts/Drawing.js', 'Scripts/Timer.js', 'Scripts/AfkTimer.js', 'Scripts/GameLog.js', 'Scripts/Reputation.js', 'Scripts/Skill.js', 'Scripts/Character.js', 'Scripts/CharacterName.js', 'Scripts/ColorPicker.js', 'Scripts/ControllerSupport.js', 'Scripts/Struggle.js', 'Scripts/Dialog.js', 'Scripts/Speech.js', 'Scripts/Text.js', 'Scripts/Inventory.js', 'Scripts/Import.js', 'Scripts/Asset.js', 'Scripts/Audio.js', 'Scripts/MiniGame.js', 'Scripts/NPC.js', 'Scripts/Validation.js', 'Scripts/Server.js', 'Scripts/Element.js', 'Scripts/Translation.js', 'Scripts/Activity.js', 'Scripts/ExtendedItem.js', 'Scripts/ModularItem.js', 'Scripts/TypedItem.js', 'src/common-shim.js', 'Screens/Character/ItemColor/ItemColor.js', 'Scripts/VibratorMode.js', 'Scripts/DynamicDraw.js', 'Scripts/Notification.js', 'Scripts/Graph.js', 'Assets/Female3DCG/Female3DCG.js', 'Screens/Inventory/Futuristic/Futuristic.js', 'Assets/Female3DCG/Female3DCGExtended.js', 'Screens/Character/Login/Login.js', 'Screens/Character/Appearance/Appearance.js', 'Screens/Character/Disclaimer/Disclaimer.js', 'Screens/Character/Creation/Creation.js', 'Screens/Character/InformationSheet/InformationSheet.js', 'Screens/Character/OnlineProfile/OnlineProfile.js', 'Screens/Character/Preference/Preference.js', 'Screens/Character/Wardrobe/Wardrobe.js', 'Screens/Character/Cheat/Cheat.js', 'Screens/Character/PasswordReset/PasswordReset.js', 'Screens/Character/FriendList/FriendList.js', 'Screens/Character/Title/Title.js', 'Screens/Character/BackgroundSelection/BackgroundSelection.js', 'Screens/Character/Relog/Relog.js', 'Screens/Online/ChatRoom/ChatRoom.js', 'Screens/Online/Game/OnlineGame.js', 'Screens/Inventory/ItemNipples/VibeNippleClamp/VibeNippleClamp.js', 'Screens/Inventory/ItemNipplesPiercings/VibeHeartPiercings/VibeHeartPiercings.js', 'Screens/Inventory/ItemVulvaPiercings/VibeHeartClitPiercing/VibeHeartClitPiercing.js', 'Screens/Inventory/ItemVulvaPiercings/TapedClitEgg/TapedClitEgg.js', 'Screens/Inventory/ItemNeck/ShockCollar/ShockCollar.js', 'Screens/Inventory/ItemNeck/AutoShockCollar/AutoShockCollar.js', 'Screens/Inventory/ItemNeckAccessories/CollarShockUnit/CollarShockUnit.js', 'Screens/Inventory/ItemNeckAccessories/CollarAutoShockUnit/CollarAutoShockUnit.js', 'Screens/Inventory/ItemArms/HempRope/HempRope.js', 'Screens/Inventory/ItemArms/HempRope/HempRopeSuspensionHogtied.js', 'Screens/Inventory/ItemHands/PaddedMittens/PaddedMittens.js', 'Screens/Inventory/ItemHands/PawMittens/PawMittens.js', 'Screens/Inventory/ItemMisc/MetalPadlock/MetalPadlock.js', 'Screens/Inventory/ItemMisc/IntricatePadlock/IntricatePadlock.js', 'Screens/Inventory/ItemMisc/TimerPadlock/TimerPadlock.js', 'Screens/Inventory/ItemMisc/CombinationPadlock/CombinationPadlock.js', 'Screens/Inventory/ItemMisc/HighSecurityPadlock/HighSecurityPadlock.js', 'Screens/Inventory/ItemMisc/PasswordPadlock/PasswordPadlock.js', 'Screens/Inventory/ItemMisc/SafewordPadlock/SafewordPadlock.js', 'Screens/Inventory/ItemMisc/TimerPasswordPadlock/TimerPasswordPadlock.js', 'Screens/Inventory/ItemMisc/MistressTimerPadlock/MistressTimerPadlock.js', 'Screens/Inventory/ItemMisc/OwnerTimerPadlock/OwnerTimerPadlock.js', 'Screens/Inventory/ItemMisc/OwnerPadlock/OwnerPadlock.js', 'Screens/Inventory/ItemMisc/LoversPadlock/LoversPadlock.js', 'Screens/Inventory/ItemMisc/LoversTimerPadlock/LoversTimerPadlock.js', 'Screens/Inventory/ItemMisc/MistressPadlock/MistressPadlock.js', 'Screens/Inventory/ItemMisc/PandoraPadlock/PandoraPadlock.js', 'Screens/Inventory/ItemMisc/ExclusivePadlock/ExclusivePadlock.js', 'Screens/Inventory/ItemMouth/FuturisticPanelGag/FuturisticPanelGag.js', 'Screens/Inventory/ItemMouth/FuturisticHarnessPanelGag/FuturisticHarnessPanelGag.js', 'Screens/Inventory/ItemMouth/FuturisticHarnessBallGag/FuturisticHarnessBallGag.js', 'Screens/Inventory/ItemNeck/FuturisticCollar/FuturisticCollar.js', 'Screens/Inventory/ItemTorso/FuturisticHarness/FuturisticHarness.js', 'Screens/Inventory/ItemHands/SpankingToys/SpankingToy.js', 'Screens/Inventory/ItemFeet/HempRope/HempRope.js', 'Screens/Inventory/ItemPelvis/LoveChastityBelt/LoveChastityBelt.js', 'Screens/Inventory/ItemNeckAccessories/CollarNameTag/CollarNameTag.js', 'Screens/Inventory/ItemNeckAccessories/CollarNameTagOval/CollarNameTagOval.js', 'Screens/Inventory/ItemNeckAccessories/CollarNameTagPet/CollarNameTagPet.js', 'Screens/Inventory/ItemNeckAccessories/CollarNameTagLover/CollarNameTagLover.js', 'Screens/Inventory/ItemNeckAccessories/CollarNameTagLivestock/CollarNameTagLivestock.js', 'Screens/Inventory/ItemNeck/SlaveCollar/SlaveCollar.js', 'Screens/Inventory/ItemButt/VibratingButtplug/VibratingButtplug.js', 'Screens/Inventory/ItemNipples/TapedVibeEggs/TapedVibeEggs.js', 'Screens/Inventory/ItemVulva/InflatableVibeDildo/InflatableVibeDildo.js', 'Screens/Inventory/ItemVulva/LoversVibrator/LoversVibrator.js', 'Screens/Inventory/ItemButt/InflVibeButtPlug/InflVibeButtPlug.js', 'Screens/Inventory/ItemDevices/Sybian/Sybian.js', 'Screens/Inventory/ItemButt/AnalBeads2/AnalBeads2.js', 'Screens/Inventory/ItemButt/VibratingDildoPlug/VibratingDildoPlug.js', 'Screens/Inventory/ItemButt/LockingVibePlug/LockingVibePlug.js', 'Screens/Inventory/ItemArms/FullLatexSuit/FullLatexSuit.js', 'Screens/Inventory/ItemVulva/FuturisticVibrator/FuturisticVibrator.js', 'Screens/Inventory/ItemDevices/Locker/Locker.js', 'Screens/Inventory/ItemDevices/PetBowl/PetBowl.js', 'Screens/Inventory/ItemDevices/SmallLocker/SmallLocker.js', 'Screens/Inventory/ItemVulva/ClitAndDildoVibratorbelt/ClitAndDildoVibratorbelt.js', 'Screens/Inventory/ItemFeet/SpreaderVibratingDildoBar/SpreaderVibratingDildoBar.js', 'Screens/Inventory/ItemPelvis/FuturisticChastityBelt/FuturisticChastityBelt.js', 'Screens/Inventory/ItemPelvis/FuturisticTrainingBelt/FuturisticTrainingBelt.js', 'Screens/Inventory/ItemPelvis/SciFiPleasurePanties/SciFiPleasurePanties.js', 'Screens/Inventory/ItemBreast/FuturisticBra/FuturisticBra.js', 'Screens/Inventory/ItemButt/ShockPlug/ShockPlug.js', 'Screens/Inventory/ItemVulva/ShockDildo/ShockDildo.js', 'Screens/Inventory/ItemNipples/ShockClamps/ShockClamps.js', 'Screens/Inventory/ItemButt/BunnyTailVibePlug/BunnyTailVibePlug.js', 'Screens/Inventory/ItemButt/EggVibePlugXXL/EggVibePlugXXL.js', 'Screens/Inventory/ItemArms/PrisonLockdownSuit/PrisonLockdownSuit.js', 'Screens/Inventory/ItemNeckAccessories/CustomCollarTag/CustomCollarTag.js', 'Screens/Inventory/ItemNeckAccessories/ElectronicTag/ElectronicTag.js', 'Screens/Inventory/ItemLegs/MermaidTail/MermaidTail.js', 'Screens/Inventory/ItemDevices/Kennel/Kennel.js', 'Screens/Inventory/ItemMisc/WoodenSign/WoodenSign.js', 'Screens/Inventory/ItemHood/CanvasHood/CanvasHood.js', 'Screens/Inventory/ItemDevices/WoodenBox/WoodenBox.js', 'Screens/Inventory/ItemDevices/TransportWoodenBox/TransportWoodenBox.js', 'Screens/Inventory/ItemDevices/FuturisticCrate/FuturisticCrate.js', 'Screens/Inventory/ItemDevices/DollBox/DollBox.js', 'Screens/Inventory/HairAccessory3/Halo/Halo.js', 'Screens/Inventory/HairAccessory1/Halo/Halo.js', 'Screens/Inventory/ItemArms/TransportJacket/TransportJacket.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeon.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonGame.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonParams.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonVision.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonLoot.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonStats.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonEnemies.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonRestraints.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonFight.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonHUD.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonDraw.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonMagic.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonShrine.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonItem.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonDress.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonConsumables.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonInventory.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonMultiplayer.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonLore.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonCurse.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonReputation.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonTraps.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonPathfinding.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonBuffs.js', 'Screens/MiniGame/KinkyDungeon/KinkyDungeonEvents.js', 'Screens/Inventory/ItemDevices/VacBedDeluxe/VacBedDeluxe.js', 'Screens/Inventory/ItemDevices/FuckMachine/FuckMachine.js', 'Screens/Inventory/ClothAccessory/Bib/Bib.js', 'Screens/Inventory/Wings/SteampunkWings/SteampunkWings.js', 'Screens/Inventory/ItemNeck/TechnoCollar/TechnoCollar.js', 'src/shim.js', 'src/index-shim.js'];

        function remap(url) {
            return (url.startsWith('src') ? '' : upstreamUrl) + url;
        }

        function query(url, do_remap = true) {
            return query_internal(remap(url));
        }
        function query_internal(url) {
            return new Promise((resolve, reject) => {
                let req = new XMLHttpRequest();
                req.overrideMimeType('text/plain');
                req.open('GET', url);
                req.onload = () => resolve(req);
                req.onerror = () => reject('Error requesting: ' + url);
                req.send();
            });
        }

        let upstreamUrl;

        async function load() {
            const params = new URLSearchParams(window.location.search);
            let targetCommit = COMMIT;

            let user = params.has('user') ? params.get('user') : USER;
            let repo = params.has('repo') ? params.get('repo') : REPO;
            let branch = params.has('branch') ? params.get('branch') : BRANCH;
            let latest = params.has('v') && params.get('v') == 'latest';
        
            if (params.has('commit')) {
                targetCommit = params.get('commit');
                console.log('Using commit: ' + targetCommit);
            } else if (params.has('user') || params.has('branch') || params.has('repo') || latest) {
                // Query github API
                let api_url = `https://api.github.com/repos/${user}/${repo}/commits/${branch}`;
                try {
                    let res = await query_internal(api_url);
                    targetCommit = JSON.parse(res.responseText)['sha'];
                    console.log(`Using latest commit from ${user}/${repo} on branch ${branch}: ${targetCommit}`);
                } catch (e) {
                    console.log(`Failed to query Github API. Send: ${api_url} Response: ${res}`);
                }
            }

            upstreamUrl = `https://raw.githubusercontent.com/${user}/${repo}/${targetCommit}/BondageClub/`;

            let styles = await Promise.all(STYLES.map(query));
            styles.forEach(req => {
                let style = document.createElement('style');
                style.innerHTML = req.responseText;
                document.head.appendChild(style);
            });

            let sources = await Promise.all(SOURCES.map(query));
            sources.forEach(req => {
                let script = document.createElement('script');
                script.innerHTML = req.responseText;
                document.body.appendChild(script);
            });

            init();
        }

        Click = () => {};
        TouchStart = () => {};
        MouseMove = () => {};
        LoseFocus = () => {};

        load().then(
            _ => console.log('Loaded successfully'),
            err => console.log(err)
        );

    </script>

    <canvas id="MainCanvas" Width="2000" Height="1000" onClick="Click(event);" onTouchStart="TouchStart(event);" onMouseMove="MouseMove(event);" onMouseLeave="LoseFocus(event);"></canvas>
</body>
</html>